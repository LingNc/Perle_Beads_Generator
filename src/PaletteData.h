#pragma once

#include <string>
#include <unordered_map>
#include <vector>
#include "Types.h"

namespace PaletteData {

// 硬编码的调色板数据 - 来自colorSystemMapping.json
const std::unordered_map<std::string, std::unordered_map<std::string, std::string>> COLOR_MAPPING = {
    {"#FAF4C8", {{"MARD", "A01"}, {"COCO", "E02"}, {"漫漫", "E2"}, {"盼盼", "65"}, {"咪小窝", "77"}}},
    {"#FFFFD5", {{"MARD", "A02"}, {"COCO", "E01"}, {"漫漫", "B1"}, {"盼盼", "2"}, {"咪小窝", "2"}}},
    {"#FEFF8B", {{"MARD", "A03"}, {"COCO", "E05"}, {"漫漫", "B2"}, {"盼盼", "28"}, {"咪小窝", "28"}}},
    {"#FBED56", {{"MARD", "A04"}, {"COCO", "E07"}, {"漫漫", "B3"}, {"盼盼", "3"}, {"咪小窝", "3"}}},
    {"#F4D738", {{"MARD", "A05"}, {"COCO", "D03"}, {"漫漫", "B4"}, {"盼盼", "74"}, {"咪小窝", "79"}}},
    {"#FEAC4C", {{"MARD", "A06"}, {"COCO", "D05"}, {"漫漫", "B5"}, {"盼盼", "29"}, {"咪小窝", "29"}}},
    {"#FE8B4C", {{"MARD", "A07"}, {"COCO", "D08"}, {"漫漫", "B6"}, {"盼盼", "4"}, {"咪小窝", "4"}}},
    {"#FFDA45", {{"MARD", "A08"}, {"COCO", "E08"}, {"漫漫", "B10"}, {"盼盼", "88"}, {"咪小窝", "98"}}},
    {"#FF995B", {{"MARD", "A09"}, {"COCO", "D06"}, {"漫漫", "B11"}, {"盼盼", "90"}, {"咪小窝", "97"}}},
    {"#F77C31", {{"MARD", "A10"}, {"COCO", "D07"}, {"漫漫", "B12"}, {"盼盼", "89"}, {"咪小窝", "96"}}},
    {"#FFDD99", {{"MARD", "A11"}, {"COCO", "D01"}, {"漫漫", "E11"}, {"盼盼", "100"}, {"咪小窝", "109"}}},
    {"#FE9F72", {{"MARD", "A12"}, {"COCO", "K09"}, {"漫漫", "A18"}, {"盼盼", "99"}, {"咪小窝", "110"}}},
    {"#FFC365", {{"MARD", "A13"}, {"COCO", "D04"}, {"漫漫", "B13"}, {"盼盼", "131"}, {"咪小窝", "116"}}},
    {"#FD543D", {{"MARD", "A14"}, {"COCO", "C05"}, {"漫漫", "B14"}, {"盼盼", "138"}, {"咪小窝", "135"}}},
    {"#FFF365", {{"MARD", "A15"}, {"COCO", "E04"}, {"漫漫", "B15"}, {"盼盼", "150"}, {"咪小窝", "150"}}},
    {"#E6EE31", {{"MARD", "B01"}, {"COCO", "F05"}, {"漫漫", "C1"}, {"盼盼", "48"}, {"咪小窝", "48"}}},
    {"#63F347", {{"MARD", "B02"}, {"COCO", "F08"}, {"漫漫", "C2"}, {"盼盼", "33"}, {"咪小窝", "33"}}},
    {"#9EF780", {{"MARD", "B03"}, {"COCO", "F04"}, {"漫漫", "C7"}, {"盼盼", "26"}, {"咪小窝", "26"}}},
    {"#5DE035", {{"MARD", "B04"}, {"COCO", "F09"}, {"漫漫", "C3"}, {"盼盼", "66"}, {"咪小窝", "78"}}},
    {"#35E352", {{"MARD", "B05"}, {"COCO", "F10"}, {"漫漫", "C4"}, {"盼盼", "39"}, {"咪小窝", "39"}}},
    {"#65E2A6", {{"MARD", "B06"}, {"COCO", "G04"}, {"漫漫", "C9"}, {"盼盼", "11"}, {"咪小窝", "11"}}},
    {"#3DAF80", {{"MARD", "B07"}, {"COCO", "G05"}, {"漫漫", "C10"}, {"盼盼", "44"}, {"咪小窝", "44"}}},
    {"#1C9C4F", {{"MARD", "B08"}, {"COCO", "F11"}, {"漫漫", "C5"}, {"盼盼", "10"}, {"咪小窝", "10"}}},
    {"#95D3C2", {{"MARD", "B10"}, {"COCO", "G03"}, {"漫漫", "C11"}, {"盼盼", "96"}, {"咪小窝", "100"}}},
    {"#5D722A", {{"MARD", "B11"}, {"COCO", "F14"}, {"漫漫", "C12"}, {"盼盼", "97"}, {"咪小窝", "99"}}},
    {"#166F41", {{"MARD", "B12"}, {"COCO", "F12"}, {"漫漫", "C13"}, {"盼盼", "106"}, {"咪小窝", "111"}}},
    {"#CAEB7B", {{"MARD", "B13"}, {"COCO", "F02"}, {"漫漫", "C14"}, {"盼盼", "128"}, {"咪小窝", "119"}}},
    {"#ADE946", {{"MARD", "B14"}, {"COCO", "F06"}, {"漫漫", "C15"}, {"盼盼", "129"}, {"咪小窝", "117"}}},
    {"#2E5132", {{"MARD", "B15"}, {"COCO", "F15"}, {"漫漫", "C16"}, {"盼盼", "130"}, {"咪小窝", "122"}}},
    {"#C5ED9C", {{"MARD", "B16"}, {"COCO", "F03"}, {"漫漫", "C17"}, {"盼盼", "141"}, {"咪小窝", "133"}}},
    {"#9BB13A", {{"MARD", "B17"}, {"COCO", "F13"}, {"漫漫", "C18"}, {"盼盼", "142"}, {"咪小窝", "141"}}},
    {"#E6EE49", {{"MARD", "B18"}, {"COCO", "F07"}, {"漫漫", "C19"}, {"盼盼", "147"}, {"咪小窝", "147"}}},
    {"#A45EC7", {{"MARD", "D08"}, {"COCO", "I04"}, {"漫漫", "D12"}, {"盼盼", "46"}, {"咪小窝", "46"}}},
    {"#8854B3", {{"MARD", "D09"}, {"COCO", "I09"}, {"漫漫", "D8"}, {"盼盼", "47"}, {"咪小窝", "47"}}},
    {"#2F1F90", {{"MARD", "D12"}, {"COCO", "I10"}, {"漫漫", "D9"}, {"盼盼", "82"}, {"咪小窝", "87"}}},
    {"#E970CC", {{"MARD", "E09"}, {"COCO", "I01"}, {"漫漫", "E7"}, {"盼盼", "109"}, {"咪小窝", "112"}}},
    {"#D33793", {{"MARD", "E10"}, {"COCO", "I02"}, {"漫漫", "E8"}, {"盼盼", "108"}, {"咪小窝", "115"}}},
    {"#B5006D", {{"MARD", "E12"}, {"COCO", "I03"}, {"漫漫", "E9"}, {"盼盼", "107"}, {"咪小窝", "113"}}},
    {"#FFD1BA", {{"MARD", "F01"}, {"COCO", "K01"}, {"漫漫", "A1"}, {"盼盼", "73"}, {"咪小窝", "73"}}},
    {"#F8C7C9", {{"MARD", "F02"}, {"COCO", "K02"}, {"漫漫", "A2"}, {"盼盼", "75"}, {"咪小窝", "80"}}},
    {"#FD957B", {{"MARD", "F03"}, {"COCO", "K03"}, {"漫漫", "A3"}, {"盼盼", "76"}, {"咪小窝", "81"}}},
    {"#FC3D46", {{"MARD", "F04"}, {"COCO", "C06"}, {"漫漫", "A4"}, {"盼盼", "24"}, {"咪小窝", "24"}}},
    {"#F74941", {{"MARD", "F05"}, {"COCO", "C07"}, {"漫漫", "A5"}, {"盼盼", "37"}, {"咪小窝", "37"}}},
    {"#FC283C", {{"MARD", "F06"}, {"COCO", "C08"}, {"漫漫", "A6"}, {"盼盼", "25"}, {"咪小窝", "25"}}},
    {"#E7002F", {{"MARD", "F07"}, {"COCO", "C09"}, {"漫漫", "A7"}, {"盼盼", "38"}, {"咪小窝", "38"}}},
    {"#943630", {{"MARD", "F08"}, {"COCO", "C10"}, {"漫漫", "A8"}, {"盼盼", "95"}, {"咪小窝", "95"}}},
    {"#971937", {{"MARD", "F09"}, {"COCO", "C11"}, {"漫漫", "A9"}, {"盼盼", "101"}, {"咪小窝", "105"}}},
    {"#BC0028", {{"MARD", "F10"}, {"COCO", "C12"}, {"漫漫", "A10"}, {"盼盼", "102"}, {"咪小窝", "106"}}},
    {"#E2677A", {{"MARD", "F11"}, {"COCO", "C01"}, {"漫漫", "A11"}, {"盼盼", "103"}, {"咪小窝", "107"}}},
    {"#8A4526", {{"MARD", "F12"}, {"COCO", "C13"}, {"漫漫", "A12"}, {"盼盼", "104"}, {"咪小窝", "108"}}},
    {"#5A2121", {{"MARD", "F13"}, {"COCO", "C14"}, {"漫漫", "A13"}, {"盼盼", "127"}, {"咪小窝", "118"}}},
    {"#FDFBFF", {{"MARD", "H01"}, {"COCO", "A01"}, {"漫漫", "H1"}, {"盼盼", "1"}, {"咪小窝", "1"}}},
    {"#FEFFFF", {{"MARD", "H02"}, {"COCO", "A02"}, {"漫漫", "H2"}, {"盼盼", "52"}, {"咪小窝", "52"}}},
    {"#B6B1BA", {{"MARD", "H03"}, {"COCO", "A03"}, {"漫漫", "H3"}, {"盼盼", "56"}, {"咪小窝", "56"}}},
    {"#89858C", {{"MARD", "H04"}, {"COCO", "A04"}, {"漫漫", "H4"}, {"盼盼", "57"}, {"咪小窝", "57"}}},
    {"#48464E", {{"MARD", "H05"}, {"COCO", "A05"}, {"漫漫", "H5"}, {"盼盼", "58"}, {"咪小窝", "58"}}},
    {"#2F2B2F", {{"MARD", "H06"}, {"COCO", "A06"}, {"漫漫", "H6"}, {"盼盼", "59"}, {"咪小窝", "59"}}},
    {"#000000", {{"MARD", "H07"}, {"COCO", "A07"}, {"漫漫", "H7"}, {"盼盼", "18"}, {"咪小窝", "18"}}},
    {"#FFFFFF", {{"MARD", "H08"}, {"COCO", "A08"}, {"漫漫", "H8"}, {"盼盼", "72"}, {"咪小窝", "72"}}},
    {"#E8FFE7", {{"MARD", "J01"}, {"COCO", "G01"}, {"漫漫", "J1"}, {"盼盼", "12"}, {"咪小窝", "12"}}},
    {"#A9F9FC", {{"MARD", "J02"}, {"COCO", "H01"}, {"漫漫", "J2"}, {"盼盼", "13"}, {"咪小窝", "13"}}},
    {"#A0E2FB", {{"MARD", "J03"}, {"COCO", "H02"}, {"漫漫", "J3"}, {"盼盼", "31"}, {"咪小窝", "31"}}},
    {"#41CCFF", {{"MARD", "J04"}, {"COCO", "H03"}, {"漫漫", "J4"}, {"盼盼", "32"}, {"咪小窝", "32"}}},
    {"#01ACEB", {{"MARD", "J05"}, {"COCO", "H04"}, {"漫漫", "J5"}, {"盼盼", "15"}, {"咪小窝", "15"}}},
    {"#50AAF0", {{"MARD", "J06"}, {"COCO", "H05"}, {"漫漫", "J6"}, {"盼盼", "16"}, {"咪小窝", "16"}}},
    {"#3677D2", {{"MARD", "J07"}, {"COCO", "H06"}, {"漫漫", "J7"}, {"盼盼", "17"}, {"咪小窝", "17"}}},
    {"#0F54C0", {{"MARD", "J08"}, {"COCO", "H07"}, {"漫漫", "J8"}, {"盼盼", "40"}, {"咪小窝", "40"}}},
    {"#324BCA", {{"MARD", "J09"}, {"COCO", "H08"}, {"漫漫", "J9"}, {"盼盼", "41"}, {"咪小窝", "41"}}},
    {"#3EBCE2", {{"MARD", "J10"}, {"COCO", "H09"}, {"漫漫", "J10"}, {"盼盼", "42"}, {"咪小窝", "42"}}},
    {"#28DDDE", {{"MARD", "J11"}, {"COCO", "H10"}, {"漫漫", "J11"}, {"盼盼", "43"}, {"咪小窝", "43"}}},
    {"#CDE8FF", {{"MARD", "J12"}, {"COCO", "H11"}, {"漫漫", "J12"}, {"盼盼", "83"}, {"咪小窝", "88"}}},
    {"#D5FDFF", {{"MARD", "J13"}, {"COCO", "H12"}, {"漫漫", "J13"}, {"盼盼", "84"}, {"咪小窝", "89"}}},
    {"#22C4C6", {{"MARD", "J14"}, {"COCO", "H13"}, {"漫漫", "J14"}, {"盼盼", "85"}, {"咪小窝", "90"}}},
    {"#1557A8", {{"MARD", "J15"}, {"COCO", "H14"}, {"漫漫", "J15"}, {"盼盼", "86"}, {"咪小窝", "91"}}},
    {"#04D1F6", {{"MARD", "J16"}, {"COCO", "H15"}, {"漫漫", "J16"}, {"盼盼", "87"}, {"咪小窝", "92"}}}
};

// 默认144色调色板（基于原项目的144-perler-palette.json）
const std::vector<std::string> DEFAULT_144_PALETTE = {
    "#FAF4C8", "#FFFFD5", "#FEFF8B", "#FBED56", "#F4D738", "#FEAC4C", "#FE8B4C", "#FFDA45",
    "#FF995B", "#F77C31", "#FFDD99", "#FE9F72", "#FFC365", "#FD543D", "#FFF365", "#E6EE31",
    "#63F347", "#9EF780", "#5DE035", "#35E352", "#65E2A6", "#3DAF80", "#1C9C4F", "#95D3C2",
    "#5D722A", "#166F41", "#CAEB7B", "#ADE946", "#2E5132", "#C5ED9C", "#9BB13A", "#E6EE49",
    "#24B88C", "#C2F0CC", "#E8FFE7", "#A9F9FC", "#A0E2FB", "#41CCFF", "#01ACEB", "#50AAF0",
    "#3677D2", "#0F54C0", "#324BCA", "#3EBCE2", "#28DDDE", "#CDE8FF", "#D5FDFF", "#22C4C6",
    "#1557A8", "#04D1F6", "#AEB4F2", "#858EDD", "#2F54AF", "#B843C5", "#AC7BDE", "#8854B3",
    "#E2D3FF", "#D5B9F8", "#B9BAE1", "#DE9AD4", "#B90095", "#8B279B", "#2F1F90", "#E3E1EE",
    "#C4D4F6", "#A45EC7", "#D8C3D7", "#9C32B2", "#9A009B", "#FDD3CC", "#FEC0DF", "#FFB7E7",
    "#E8649E", "#F551A2", "#F13D74", "#C63478", "#FFDBE9", "#E970CC", "#D33793", "#FCDDD2",
    "#F78FC3", "#B5006D", "#FFD1BA", "#F8C7C9", "#FD957B", "#FC3D46", "#F74941", "#FC283C",
    "#E7002F", "#943630", "#971937", "#BC0028", "#E2677A", "#8A4526", "#5A2121", "#FD4E6A",
    "#F35744", "#FFA9AD", "#FFE2CE", "#FFC4AA", "#F4C3A5", "#E1B383", "#EDB045", "#E99C17",
    "#9D5B3E", "#753832", "#E6B483", "#D98C39", "#E0C593", "#FFC890", "#B7714A", "#8D614C",
    "#FCF9E0", "#F2D9BA", "#78524B", "#FDFBFF", "#FEFFFF", "#B6B1BA", "#89858C", "#48464E",
    "#2F2B2F", "#000000", "#E7D6DB", "#EDEDED", "#EEE9EA", "#CECDD5", "#FFF5ED", "#F5ECD2",
    "#CFD7D3", "#BCC6B8", "#8AA386", "#697D80", "#E3D2BC", "#D0CCAA", "#B0A782", "#B4A497",
    "#B38281", "#A58767", "#C5B2BC", "#9F7594", "#644749", "#D19066", "#C77362", "#757D78",
    "#FFFFFF"
};

// 获取颜色对应的色号
inline std::string getColorKey(const std::string& hexColor, const std::string& colorSystem = "MARD") {
    auto colorIt = COLOR_MAPPING.find(hexColor);
    if (colorIt != COLOR_MAPPING.end()) {
        auto systemIt = colorIt->second.find(colorSystem);
        if (systemIt != colorIt->second.end()) {
            return systemIt->second;
        }
    }
    return "?";
}

// 获取144色调色板
inline std::vector<PaletteColor> get144ColorPalette(const std::string& colorSystem = "MARD") {
    std::vector<PaletteColor> palette;
    for (const std::string& hex : DEFAULT_144_PALETTE) {
        PaletteColor color;
        color.hex = hex;
        color.key = getColorKey(hex, colorSystem);

        // 转换hex到RGB
        if (hex.length() == 7 && hex[0] == '#') {
            try {
                color.r = std::stoi(hex.substr(1, 2), nullptr, 16);
                color.g = std::stoi(hex.substr(3, 2), nullptr, 16);
                color.b = std::stoi(hex.substr(5, 2), nullptr, 16);
                palette.push_back(color);
            } catch (...) {
                // 跳过无效颜色
            }
        }
    }
    return palette;
}

// 获取全色调色板（所有291色）
inline std::vector<PaletteColor> getFullColorPalette(const std::string& colorSystem = "MARD") {
    std::vector<PaletteColor> palette;
    for (const auto& [hex, systems] : COLOR_MAPPING) {
        auto systemIt = systems.find(colorSystem);
        if (systemIt != systems.end()) {
            PaletteColor color;
            color.hex = hex;
            color.key = systemIt->second;

            // 转换hex到RGB
            if (hex.length() == 7 && hex[0] == '#') {
                try {
                    color.r = std::stoi(hex.substr(1, 2), nullptr, 16);
                    color.g = std::stoi(hex.substr(3, 2), nullptr, 16);
                    color.b = std::stoi(hex.substr(5, 2), nullptr, 16);
                    palette.push_back(color);
                } catch (...) {
                    // 跳过无效颜色
                }
            }
        }
    }
    return palette;
}

} // namespace PaletteData
